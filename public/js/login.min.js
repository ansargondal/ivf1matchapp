$(function () {

    var form = $("#form-login");

    form.validate({
        rules: {
            email: {
                required: true,
                email: true
            },
            password: {
                required: true
            }
        },
        messages: {
            email: {
                required: "Please enter your email.",
            },
            password: {
                required: "Please enter your password.",
            }
        }
    });

    //remove the 'credentials are incorrect' Custom error
    //When user clear outs the filed.
    $('#password').on('keyup', function (evt) {
        var len = $(this).val().length;

        if (len < 1) $('span.error').remove();
    });


    form.find('.btn-submit').on('click', function (evt) {
        evt.preventDefault();

        $('span.error').remove();

        var isValid = form.valid();

        if (isValid) form.submit();
    });

    form.submit(function (evt) {
        evt.preventDefault();

        var form = $(this);
        var btn = $(this).find('button.btn-submit');

        //if validation fails stop form submission
        var isValid = $(this).valid();
        if (!isValid) return false;

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: form.attr('method'),
            data: form.serialize(),
            dataType: "json",
            success: function (response) {

                if (!response.error) {
                    window.location.replace('/admin');
                } else {
                    form.find('.error').remove();
                    form.find('[name="password"]').after('<span class="error">' + response.message + '</span>');
                }
            },
            error: function (response) {
            },
            complete: function () {
                hideSpinner(btn, 'Login');
            }
        });
    });
});