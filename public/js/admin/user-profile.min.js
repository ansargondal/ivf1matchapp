$(function () {

    $('#user-info').validate({
        rules: {
            username: {
                required: true,
                minlength: 4
            },
            first_name: {
                required: true,
                minlength: 2
            },
            last_name: {
                required: true,
                minlength: 2
            },
            email: {
                required: true,
                email: true
            },
        },
        messages: {
            firstname: {
                required: "Please enter your firstname.",
                minlength: "Firstname must have 2 atleast characters."
            },
            lastname: {
                required: "Please enter your lastname.",
                minlength: "Lastname must have 2 atleast characters."
            },
            email: "Pease enter valid email.",
        },

    });

    $('button#js-btn-update').click(function (evt) {
        evt.preventDefault();

        var form = $('#form-user-update');
        var btn = $(this);

        var data = form.serializeArray();
        data.push({name: '_method', value: 'patch'}); //add patch

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: 'post',
            data: data,
            dataType: 'json',

            success: function (response) {

                if (!response.error) {

                    notify(response.message, response.title);
                    var first_name = form.find('[name=first_name]').val();
                    var last_name = form.find('[name=last_name]').val();

                    var full_name = capitalize(first_name)+ ' ' + capitalize(last_name);

                    $('#full-name').text(full_name);
                }
            },
            complete: function () {
                hideSpinner(btn, 'UPDATE');
            }
        });
    });
});

 function  capitalize(s) {
    if (typeof s !== 'string') return '';
    return s.charAt(0).toUpperCase() + s.slice(1)
}
