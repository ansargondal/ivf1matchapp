$(function () {
    $('#myTab a').on('click', function (e) {
        e.preventDefault();
        $(this).tab('show')
    });

    var active = $('#accordion .show').prev().addClass('active');

    active.find('a').append('<i class="fa fa-minus pull-right"></i>');
//    active.find('a').append('<span class="glyphicon glyphicon-minus pull-right"></span>');
    $('#accordion .card-header').not(active).find('a').prepend('<i class="fa fa-plus pull-right"></i>');
//    $('#accordion .panel-heading').not(active).find('a').prepend('<span class="glyphicon glyphicon-plus pull-right"></span>');
    $('#accordion').on('show.bs.collapse', function (e) {
        $('#accordion .card-header.active').removeClass('active').find('.fa').toggleClass('fa-plus fa-minus');
        $(e.target).prev().addClass('active').find('.fa').toggleClass('fa-plus fa-minus');
    });
    $('#accordion').on('hide.bs.collapse', function (e) {
        $(e.target).prev().removeClass('active').find('.fa').removeClass('fa-minus').addClass('fa-plus');
    });


    var contactModal = $('#modal-contact-donor');

    $('.btn-contact-donor').on('click', function (evt) {
        evt.preventDefault();
        contactModal.modal({
            modal: true,
            keyboard: false,
            backdrop: 'static'
        });

        var donor_id = $(this).data('id');

        contactModal.find('[name=id]').val(donor_id);
    });

    var formDonor = $('#form-contact-donor');

    formDonor.validate({
        rules: {
            subject: {
                required: true
            },
            message: {
                required: true
            }
        }
    });


    //contact donor message form
    formDonor.submit(function (evt) {
        evt.preventDefault();

        var form = $(this);
        var btn = $(this).find('.btn-submit');

        //if validation fails stop form submission
        var isValid = $(this).valid();
        if (!isValid) {
            return 0;
        }

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: form.attr('method'),
            data: form.serialize(),
            dataType: "json",
            success: function (response) {

                //reset form data
                form[0].reset();

                if (!response.error) {

                    $('#modal-contact-donor').modal('hide');
                    $('#modal-message-sent').modal('show');
                }
            },
            error: function (response) {

            },
            complete: function () {
                hideSpinner(btn, 'SEND');
            }
        });
    });


});

