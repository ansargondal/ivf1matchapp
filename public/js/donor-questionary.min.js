$(function () {
    $body = $('body');

    //show warning before user closes the tab
    add_warning();

    //revoke the form submission on enter key press
    $('form input').keydown(function (event) {
        if (event.keyCode == 13) {
            event.preventDefault();
            return false;
        }
    });

    //globally changed error message
    //this field is required  => '*required'
    $.validator.messages.required = '*required';

    $('.date-picker').datepicker({
        changeMonth: true,
        changeYear: true,
    });

    $('#date_birth').datepicker({
        minDate: "-65Y",
        maxDate: "-15Y",

        changeMonth: true,
        changeYear: true,
    });


    // Step show event
    $("#smartwizard").on("showStep", function (e, anchorObject, stepNumber, stepDirection, stepPosition) {
        //alert("You are on step "+stepNumber+" now");
        if (stepPosition === 'first') {
//                   $("#prev-btn").addClass('disabled');
        } else if (stepPosition === 'final') {
            $("#next-btn").addClass('disabled');
        } else {
//                   $("#prev-btn").removeClass('disabled');
            $("#next-btn").removeClass('disabled');
        }
    });

    //datepicker validations  label fixes
    $date.datepicker({}).on('change', function (e) {
        $(this).parents('.form-group').find('label').addClass('focus');
        $(this).valid();
    });

    //remove error on change of dropdown value
    $body.on('change', '.form-control', function (evt) {
        $(this).valid();
    });


    // Toolbar extra buttons
    var btnFinish = $('<button></button>').text('Finish')
        .addClass('btn btn-info')
        .on('click', function () {
            alert('Finish Clicked');
        });
    var btnCancel = $('<button></button>').text('Cancel')
        .addClass('btn btn-danger')
        .on('click', function () {
            $('#smartwizard').smartWizard("reset");
        });

    // Please note enabling option "showStepURLhash" will make navigation conflict for multiple wizard in a page.
    // so that option is disabling => showStepURLhash: false

    // Smart Wizard 1
    $('#smartwizard').smartWizard({
        selected: 0,
        theme: 'arrows',
        transitionEffect: 'fade',
        showStepURLhash: false,
        toolbarSettings: {
            toolbarPosition: 'bottom',
            toolbarExtraButtons: [btnFinish, btnCancel]
        }
    });


//region  (STEP 1) Validation Donor Contact
    $('#step1').validate({
        rules: {
            fname: {
                required: true,
                minlength: 2
            },
            lname: {
                required: true,
                minlength: 2
            },
            dob: {
                required: true
            },
            street: {
                required: true
            },
            city: {
                required: true
            },
            state: {
                required: true
            },
            zip: {
                required: true
            }
        },
        messages: {
            fname: {
                required: 'first name is required'
            },
            lname: {
                required: 'last name is required'
            },
            dob: {
                required: "Must be in format MM/DD/YYYY"
            },
            zip: {
                required: 'zip code is required'
            }
        },
    });

    $body.on('click', '#submit1', function (evt) {
        evt.preventDefault();

        var form = $('#step1');

        var isValid = form.valid();

        if (!isValid) {
            scrollToError(form);
            return 0;
        } else {
            form.submit();
        }
    });

//endregion

//region  (STEP 1) Donor Contact Information Saving using Ajax Logic
    $('#step1').submit(function (evt) {
        evt.preventDefault();

        var form = $(this);
        var btn = $(this).find('button.donor-submit');

        //if validation fails stop form submission
        var isValid = $(this).valid();
        if (!isValid) {
            scrollToError(form);
            return 0;
        }

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: form.attr('method'),
            data: form.serialize(),
            dataType: "json",
            success: function (response) {


                //calculate age by dob and fill the step 10 age field
                var age = $('#date_birth').val();

                $('#step10 [name=age]').val(getAge(age));
                addFocusOnOpenModal($('#step-10'));

                if (!response.error) {
                    $('#donor_q_next').click();
                    notify(response.message, response.title);
                }
            },
            error: function (response) {

            },
            complete: function () {
                hideSpinner(btn);
            }
        });
    });


    $('#i_starting_from').datepicker({
        changeMonth: true,
        changeYear: true,
    });
//endregion

//region (STEP 2) Validation Donor Education
    var form = $('#step2');
    $('#c_c_attending_college').on("click", function (evt) {
        form.valid();
        if ($(this).is(":checked")) {
            $('#i_c_attending_college').rules("add", {
                required: true
            });
        } else {
            $('#i_c_attending_college').rules("remove");
        }
    });
    $('#c_graduate_degree').on("click", function (evt) {
        form.valid();
        if ($(this).is(":checked")) {
            $('#i_graduate_degree').rules("add", {
                required: true
            });
        } else {
            $('#i_graduate_degree').rules("remove");
        }
    });
    $('#c_post_graduate_degree').on("click", function (evt) {

        form.valid();
        if ($(this).is(":checked")) {
            $('#i_post_graduate_degree').rules("add", {
                required: true
            });
        } else {
            $('#i_post_graduate_degree').rules("remove");
        }
    });
    $('#c_degree_other').on("click", function (evt) {
        form.valid();
        if ($(this).is(":checked")) {
            $('#i_degree_other').rules("add", {
                required: true
            });
        } else {
            $('#i_degree_other').rules("remove");
        }
    });

//convert checkbox to radio boxes for high school
    $(".high-school").change(function () {
        $(".high-school").prop('checked', false);
        $(this).prop('checked', true);
        $('#high-school .custom-error').remove();
    });


    /* Disable school checkboxes when college is checked*/
    $body.on('click', '.college', function () {
        //checks if any college checkbox is checked then disable school
        validateCollege();
    });

    $body.on('click', '#submit2', function (evt) {
        evt.preventDefault();

        var form = $('#step2');

        var isValid = form.valid();

        //at least one option should be checked
        if (!validateSchool()) {
            scrollToError(form);
            return 0;
        }

        if (!isValid) {
            scrollToError(form);
            return 0;
        } else {
            form.submit();
        }
    });

    $body.on('keyup', '#step2 .form-control', function () {
        if ($(this).val().length > 0) {
            $(this).closest('.row').find('input:checkbox').prop('checked', true);

            //checks if any college checkbox is checked then disable school
            validateCollege();
        } else {
            $(this).closest('.row').find('input:checkbox').prop('checked', false);

            //checks if any college checkbox is checked then disable school
            validateCollege();
        }
    });

//endregion

//region (STEP 2)  Donor Education Saving using Ajax
    $('#step2').submit(function (evt) {
        evt.preventDefault();

        var form = $(this);
        var btn = $(this).find('button.donor-submit');


        //if validation fails stop form submission
        var isValid = $(this).valid();
        if (!isValid) {
            scrollToError(form);
            return 0;
        }

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: form.attr('method'),
            data: form.serialize(),
            dataType: "json",
            success: function (response) {
                if (!response.error) {
                    $('#donor_q_next').click();
                    notify(response.message, response.title);
                }
            },
            error: function (response) {

            },
            complete: function () {
                hideSpinner(btn);
            }
        });
    });

//endregion

//region (STEP 3)  Sexual History Information Validation
    $('#step3').validate({
        rules: {
            martial_status: 'required',
            q1: 'required',
            q2: 'required',
            q3: 'required',
            q4: 'required',
            q5: 'required',
            q6: 'required',
            q7: 'required',
            q8: 'required',
            living_arrangement: 'required',
            partners_1_month: 'required',
            partners_6_months: 'required',
            partners_5_years: 'required',
            orientation: 'required'
        },
        messages: {
            martial_status: {
                required: "Martial Status information required."
            },
            living_arrangement: {
                required: "Living arrangement information required."
            },
        },
    });

    //at least one current sexual practice checkbox should be checked on checkbox click
    $body.on('click', '.cb-current-sexual', function () {
        validateCSexualPractice();
    });

    //at least one previous sexual practice checkbox should be checked on checkbox click
    $body.on('click', '.cb-previous-sexual', function () {
        validatePSexualPractice();
    });


    //remove error from container if user has checked a radio box
    $body.on('change', '[type=radio]', function (evt) {
        evt.preventDefault();

        $(this).parents('.radio-boxes-container').removeClass('error');
    });

    $body.on('click', '#submit3', function (evt) {
        evt.preventDefault();

        var form = $('#step3');

        var isValid = form.valid();

        //adds errors to the checkbox container which makes background red
        showRadioInputErrors(form);
        var cSexualresponse = validateCSexualPractice();
        var pSexualresponse = validatePSexualPractice();

        if (isValid && cSexualresponse === 1 && pSexualresponse === 1) {
            form.submit();
        } else {
            scrollToError(form);
            return 0;
        }
    });

//endregion

//region  (STEP 3) Sexual History Information Saving using Ajax Logic

    $('#step3').submit(function (evt) {
        evt.preventDefault();

        var form = $(this);
        var btn = $(this).find('button.donor-submit');

        //if validation fails stop form submission
        var isValid = $(this).valid();
        if (!isValid) {
            scrollToError(form);
            return 0;
        }

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: form.attr('method'),
            data: form.serialize(),
            dataType: "json",
            success: function (response) {
                if (!response.error) {
                    $('#donor_q_next').click();
                    notify(response.message, response.title);
                }
            },
            error: function (response) {

            },
            complete: function () {
                hideSpinner(btn);
            }
        });
    });

//endregion

//region (STEP 4)  Pregnancy Information Validation
    $('#step4').validate({
        rules: {
            pregnancy_history: {
                required: true
            },

            first_period: {
                required: true
            },
            bleeding_begins: {
                required: true
            },
            bleeding_ends: {
                required: true
            },
            bleeding_lasts_from: {
                required: true
            },
            bleeding_lasts_to: {
                required: true
            },
            abnormal_pap: 'required',
            pregnancy_issues: 'required',
            bleeding_between: 'required',
            bleeding_after: 'required',

            last_pap_date: {
                required: true
            },
            pills: {
                required: true
            },
            ortho_evra: {
                required: true
            },
            depo_provera: {
                required: true
            },
            norplant: {
                required: true
            },
            iud: {
                required: true
            },
            tubal_ligation: {
                required: true
            },
            condoms: {
                required: true
            },

        },
        messages: {
            martial_status: {
                required: "Pregnancy History required."
            }
            ,
            first_period: {
                required: "First Period information required."
            }
            ,
            last_pap_date: {
                required: "Last PAP required"
            }
            ,
            pills: {
                required: "Oral Contraceptives field required"
            }
            ,
            ortho_evra: {
                required: "Birth Control field required."
            }
            ,
            depo_provera: {
                required: "Progesterone Injections field required."
            }
            ,
            norplant: {
                required: "Progesterone Implants field required."
            }
            ,
            iud: {
                required: "Intrauterine Device field required."
            }
            ,
            tubal_ligation: {
                required: "Sterilization field required."
            }
            ,
            condoms: {
                required: "Condoms field required."
            },

        },
    });

    var form = $('#step4');
    $('#c_did_you_deliver_1').on("click", function (evt) {
        if ($(this).is(":checked")) {
            $('#d_yearofpregnancy_1').prop('name', 'delivery_year[]').rules("add", {
                required: true
            });
            $('#d_boyGirl_1').prop('name', 'baby_gender[]').rules("add", {
                required: true
            });
            $('#i_child_have_prob_1').prop('name', 'baby_problems[]').rules("add", {
                required: true
            });
            $('#i_how_pregnancy_end_1').prop('name', 'pregnancy_end[]').rules("add", {
                required: true
            });
        } else {
            $('#d_yearofpregnancy_1').val('').prop('placeholder', '2000').prop('name', '').rules("remove");
            $('#d_boyGirl_1').val('').prop('placeholder', 'Select').prop('name', '').rules("remove");
            $('#i_child_have_prob_1').val('').prop('name', '').rules("remove");
            $('#i_how_pregnancy_end_1').val('').prop('name', '').rules("remove");
        }
        form.valid();
    });

    $('#c_did_you_deliver_2').on("click", function (evt) {
        if ($(this).is(":checked")) {
            $('#d_yearofpregnancy_2').prop('name', 'delivery_year[]').rules("add", {
                required: true
            });
            $('#d_boyGirl_2').prop('name', 'baby_gender[]').rules("add", {
                required: true
            });
            $('#i_child_have_prob_2').prop('name', 'baby_problems[]').rules("add", {
                required: true
            });
            $('#i_how_pregnancy_end_2').prop('name', 'pregnancy_end[]').rules("add", {
                required: true
            });
        } else {
            $('#d_yearofpregnancy_2').val('').prop('placeholder', '2000').prop('name', '').rules("remove");
            $('#d_boyGirl_2').val('').prop('placeholder', 'Select').prop('name', '').rules("remove");
            $('#i_child_have_prob_2').val('').prop('name', '').rules("remove");
            $('#i_how_pregnancy_end_2').val('').prop('name', '').rules("remove");
        }
        form.valid();
    });
    $('#c_did_you_deliver_3').on("click", function (evt) {
        if ($(this).is(":checked")) {
            $('#d_yearofpregnancy_3').prop('name', 'delivery_year[]').rules("add", {
                required: true
            });
            $('#d_boyGirl_3').prop('name', 'baby_gender[]').rules("add", {
                required: true
            });
            $('#i_child_have_prob_3').prop('name', 'baby_problems[]').rules("add", {
                required: true
            });
            $('#i_how_pregnancy_end_3').prop('name', 'pregnancy_end[]').rules("add", {
                required: true
            });
        } else {
            $('#d_yearofpregnancy_3').val('').prop('placeholder', '2000').prop('name', '').rules("remove");
            $('#d_boyGirl_3').val('').prop('placeholder', 'Select').prop('name', '').rules("remove");
            $('#i_child_have_prob_3').val('').prop('name', '').rules("remove");
            $('#i_how_pregnancy_end_3').val('').prop('name', '').rules("remove");
        }
        form.valid();
    });
    $('#c_did_you_deliver_4').on("click", function (evt) {
        if ($(this).is(":checked")) {
            $('#d_yearofpregnancy_4').prop('name', 'delivery_year[]').rules("add", {
                required: true
            });
            $('#d_boyGirl_4').prop('name', 'baby_gender[]').rules("add", {
                required: true
            });
            $('#i_child_have_prob_4').prop('name', 'baby_problems[]').rules("add", {
                required: true
            });
            $('#i_how_pregnancy_end_4').prop('name', 'pregnancy_end[]').rules("add", {
                required: true
            });
        } else {
            $('#d_yearofpregnancy_4').val('').prop('placeholder', '2000').prop('name', '').rules("remove");
            $('#d_boyGirl_4').val('').prop('placeholder', 'Select').prop('name', '').rules("remove");
            $('#i_child_have_prob_4').val('').prop('name', '').rules("remove");
            $('#i_how_pregnancy_end_4').val('').prop('name', '').rules("remove");
        }
        form.valid();
    });
    $body.on('click', '#submit4', function (evt) {
        evt.preventDefault();

        var form = $('#step4');

        var isValid = form.valid();

        showRadioInputErrors(form);

        if (!isValid) {
            scrollToError(form);
            return 0;
        } else {
            form.submit();
        }
    });

//endregion

//region  (STEP 4) Pregnancy Information Saving using Ajax Logic

    $('#step4').submit(function (evt) {
        evt.preventDefault();

        var form = $(this);
        var btn = $(this).find('button.donor-submit');

        //if validation fails stop form submission
        var isValid = $(this).valid();
        if (!isValid) return 0;

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: form.attr('method'),
            data: form.serialize(),
            dataType: "json",
            success: function (response) {
                if (!response.error) {
                    $('#donor_q_next').click();
                    notify(response.message, response.title);
                }
            },
            error: function (response) {

            },
            complete: function () {
                hideSpinner(btn);
            }
        });
    });

//endregion

//region (STEP 5) Lifestyle Information Validation
    validator = $('#step5').validate({
        rules: {
            exercise_routine: {
                required: true
            },
            exercise_type: {
                required: true
            },

            diet_type: {
                required: true
            },
            diet_quality: {
                required: true
            },
            tobacco: {
                required: true
            },
            alcohol: {
                required: true
            },
            marijuana: {
                required: true
            },
            heroin: {
                required: true
            },
            cocaine: {
                required: true
            },
            meth: {
                required: true
            },
            lsd: {
                required: true
            },
            pcp: {
                required: true
            },
            injectable_drug: {
                required: true
            },
            law_trouble: 'required',
            arrested: 'required',
            convicted: 'required',
            hour_jail: 'required',
            three_days_jail: 'required',

            //other history validation

            cjd: 'required',
            dementia: 'required',
            dura_mater: 'required',
            human_gh: 'required',
            cjd_family: 'required',
            visit_uk: 'required',
            military_member: 'required',
            lived_europe: 'required',
            blood_uk: 'required',
        },
        messages: {
            exercise_routine: {
                required: "Exercise field required."
            },
        },
        exercise_type: {
            required: "Exercise Type field required."
        },
        diet_type: {
            required: "Diet field required."
        },
        diet_quality: {
            required: "Quality Diet field required."
        },
    });

    $body.on("change", "#d_cigarettesTabacco", function () {
        if ($(this).val() !== "Never") {
            $('#i_cigarettesTobacco').rules("add", {
                messages: {
                    maxlength: 'Max 50 characters are allowed.'
                },
                required: true,
                maxlength: 50
            });
        } else {
            $('#i_cigarettesTobacco').rules("remove");
        }
    });

    $body.on("change", "#d_alcohol", function () {
        if ($(this).val() !== "Never") {
            $('#i_alcohol').rules("add", {
                messages: {
                    maxlength: 'Max 50 characters are allowed.'
                },
                required: true,
                maxlength: 50
            });
        } else {
            $('#i_alcohol').rules("remove");
        }
    });

    $body.on("change", "#d_marijuana", function () {
        if ($(this).val() !== "Never") {
            $('#i_marijuana').rules("add", {
                messages: {
                    maxlength: 'Max 50 characters are allowed.'
                },
                required: true,
                maxlength: 50
            });
        } else {
            $('#i_marijuana').rules("remove");
        }
    });

    $body.on("change", "#d_heroin", function () {
        if ($(this).val() !== "Never") {
            $('#i_heroin').rules("add", {
                messages: {
                    maxlength: 'Max 50 characters are allowed.'
                },
                required: true,
                maxlength: 50
            });
        } else {
            $('#i_heroin').rules("remove");
        }
    });

    $body.on("change", "#d_cocaine", function () {
        if ($(this).val() !== "Never") {
            $('#i_cocaine').rules("add", {
                messages: {
                    maxlength: 'Max 50 characters are allowed.'
                },
                required: true,
                maxlength: 50
            });
        } else {
            $('#i_cocaine').rules("remove");
        }
    });
    $body.on("change", "#d_crystalmeth", function () {
        if ($(this).val() !== "Never") {
            $('#i_crystalmeth').rules("add", {
                messages: {
                    maxlength: 'Max 50 characters are allowed.'
                },
                required: true,
                maxlength: 50
            });
        } else {
            $('#i_crystalmeth').rules("remove");
        }
    });
    $body.on("change", "#d_lsd", function () {
        if ($(this).val() !== "Never") {
            $('#i_lsd').rules("add", {
                messages: {
                    maxlength: 'Max 50 characters are allowed.'
                },
                required: true,
                maxlength: 50
            });
        } else {
            $('#i_lsd').rules("remove");
        }
    });
    $body.on("change", "#d_pcp", function () {
        if ($(this).val() !== "Never") {
            $('#i_pcp').rules("add", {
                messages: {
                    maxlength: 'Max 50 characters are allowed.'
                },
                required: true,
                maxlength: 50
            });
        } else {
            $('#i_pcp').rules("remove");
        }
    });

    $body.on("change", "#d_injectable", function () {
        if ($(this).val() !== "Never") {
            $('#i_injectable').rules("add", {
                messages: {
                    maxlength: 'Max 50 characters are allowed.'
                },
                required: true,
                maxlength: 50
            });
        } else {
            $('#i_injectable').rules("remove");
        }
    });

    $('[name=arrested]').on("click", function (evt) {
        if ($(this).is("#arrested-yes")) {
            $('#i_arrested').rules("add", {
                required: true
            });
        } else {
            $('#i_arrested').rules("remove");
        }
    });

    $('[name=convicted]').on("click", function (evt) {
        if ($(this).is("#convicted-yes")) {
            $('#i_convicted').rules("add", {
                required: true
            });
        } else {
            $('#i_convicted').rules("remove");
        }
    });

    var form = $('#step5');

    $('#d_n_used_1').datepicker({
        changeMonth: true,
        changeYear: true,
    });

    $('#s_n_used_1').on("click", function (evt) {
        if ($(this).is(":checked")) {
            $('#d_n_used_1').prop('name', 'tattoo_date[]').rules("add", {
                required: true
            });
            $('#t_n_used_1').prop('name', 'tattoo[]').rules("add", {
                required: true
            });
            $('#i_n_used_1').prop('name', 'tattoo_location[]').rules("add", {
                required: true
            });
        } else {
            $('#d_n_used_1').val('').prop('placeholder', 'Date').prop('name', '').rules("remove");
            $('#t_n_used_1').val('').prop('placeholder', 'Select').prop('name', '').rules("remove");
            $('#i_n_used_1').val('').prop('name', '').rules("remove");
        }

        form.valid();
    });

    $('#s_n_used_2').on("click", function (evt) {
        if ($(this).is(":checked")) {
            $('#d_n_used_2').prop('name', 'tattoo_date[]').rules("add", {
                required: true
            });
            $('#t_n_used_2').prop('name', 'tattoo[]').rules("add", {
                required: true
            });
            $('#i_n_used_2').prop('name', 'tattoo_location[]').rules("add", {
                required: true
            });
        } else {
            $('#d_n_used_2').val('').prop('placeholder', 'Date').prop('name', '').rules("remove");
            $('#t_n_used_2').val('').prop('placeholder', 'Select').prop('name', '').rules("remove");
            $('#i_n_used_2').val('').prop('name', '').rules("remove");
        }
        form.valid();
    });

    $('#s_n_used_3').on("click", function (evt) {
        if ($(this).is(":checked")) {
            $('#d_n_used_3').prop('name', 'tattoo_date[]').rules("add", {
                required: true
            });
            $('#t_n_used_3').prop('name', 'tattoo[]').rules("add", {
                required: true
            });
            $('#i_n_used_3').prop('name', 'tattoo_location[]').rules("add", {
                required: true
            });
        } else {
            $('#d_n_used_3').val('').prop('placeholder', 'Date').prop('name', '').rules("remove");
            $('#t_n_used_3').val('').prop('placeholder', 'Select').prop('name', '').rules("remove");
            $('#i_n_used_3').val('').prop('name', '').rules("remove");
        }
        form.valid();
    });

    $('#s_n_used_4').on("click", function (evt) {
        if ($(this).is(":checked")) {
            $('#d_n_used_4').prop('name', 'tattoo_date[]').rules("add", {
                required: true
            });
            $('#t_n_used_4').prop('name', 'tattoo[]').rules("add", {
                required: true
            });
            $('#i_n_used_4').prop('name', 'tattoo_location[]').rules("add", {
                required: true
            });
        } else {
            $('#d_n_used_4').val('').prop('placeholder', 'Date').prop('name', '').rules("remove");
            $('#t_n_used_4').val('').prop('placeholder', 'Select').prop('name', '').rules("remove");
            $('#i_n_used_4').val('').prop('name', '').rules("remove");
        }
        form.valid();
    });

    $('#s_n_used_5').on("click", function (evt) {
        if ($(this).is(":checked")) {
            $('#d_n_used_5').prop('name', 'tattoo_date[]').rules("add", {
                required: true
            });
            $('#t_n_used_5').prop('name', 'tattoo[]').rules("add", {
                required: true
            });
            $('#i_n_used_5').prop('name', 'tattoo_location[]').rules("add", {
                required: true
            });
        } else {
            $('#d_n_used_5').val('').prop('placeholder', 'Date').prop('name', '').rules("remove");
            $('#t_n_used_5').val('').prop('placeholder', 'Select').prop('name', '').rules("remove");
            $('#i_n_used_5').val('').prop('name', '').rules("remove");
        }
        form.valid();
    });


    $body.on('click', '#submit5', function (evt) {
        evt.preventDefault();

        var form = $('#step5');

        var isValid = form.valid();

        showRadioInputErrors(form);

        if (!isValid) {
            scrollToError(form);
            return 0;
        } else {
            form.submit();
        }
    });

//endregion

//region  (STEP 5) Lifestyle Information Saving using Ajax Logic
    $('#step5').submit(function (evt) {
        evt.preventDefault();

        var form = $(this);
        var btn = $(this).find('button.donor-submit');

        //if validation fails stop form submission
        var isValid = $(this).valid();
        if (!isValid) return 0;

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: form.attr('method'),
            data: form.serialize(),
            dataType: "json",
            success: function (response) {
                if (!response.error) {
                    $('#donor_q_next').click();
                    notify(response.message, response.title);
                }
            },
            error: function (response) {

            },
            complete: function () {
                hideSpinner(btn);
            }
        });
    });

//endregion

//region (STEP 6)  Medical History Questions step 1 Information Validation
    var form = $('#step6');

    $('#step6').validate({
        rules: {
            injectable_last_5: 'required',
            hemophilia: 'required',
            hepatitis_contact: 'required',
            hiv: 'required',
            hepatitis: 'required',
            prison: 'required',
            tattoo: 'required',
            smallpox_vaccine: 'required',
            smallpox_contact: 'required',
            smallpox: 'required',
            west_nile_virus: 'required',
            syphilis: 'required',
            gonorrhea: 'required',
            transfusion: 'required',
            donor_rejection: 'required',
            transplant: 'required',
            transplant_contact: 'required',
            african_countries: 'required',
            african_transfusion: 'required',
            zika_virus_1: 'required',
            zika_virus_2: 'required',
            zika_virus_3: 'required',
            zika_virus_4: 'required',
        }
    });
    $('#c_blood_transfusion').on("click", function (evt) {
        form.valid();
        if ($(this).is(":checked")) {
            $('#i_blood_transfusion').rules("add", {
                required: true
            });

            form.valid();
        } else {
            $('#i_blood_transfusion').rules("remove");
            form.valid();
        }
    });

    $('#c_blood_donor').on("click", function (evt) {
        form.valid();
        if ($(this).is(":checked")) {
            $('#i_blood_donor').rules("add", {
                required: true
            });
            form.valid();
        } else {
            $('#i_blood_donor').rules("remove");
            form.valid();
        }
    });

    $body.on('click', '#submit6', function (evt) {
        evt.preventDefault();

        var form = $('#step6');

        var isValid = form.valid();

        showRadioInputErrors(form);

        if (!isValid) {
            scrollToError(form);
            return 0;
        } else {
            form.submit();
        }
    });

//endregion

//region  (STEP 6) Medical History Questions Step 1 Information Saving using Ajax Logic
    $('#step6').submit(function (evt) {
        evt.preventDefault();

        var form = $(this);
        var btn = $(this).find('button.donor-submit');

        //if validation fails stop form submission
        var isValid = $(this).valid();
        if (!isValid) {
            scrollToError(form)
            return 0;
        }

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: form.attr('method'),
            data: form.serialize(),
            dataType: "json",
            success: function (response) {
                if (!response.error) {
                    $('#donor_q_next').click();
                    notify(response.message, response.title);
                }
            },
            error: function (response) {
            },
            complete: function () {
                hideSpinner(btn);
            }
        });
    });

//endregion

//region (STEP 7) Medical History Step 2 Information Validation
    $('#step7').validate({
        rules: {
            vaccinated: {
                required: true
            }
        },
        messages: {
            vaccinated_for: {
                required: "Answer to this question is required."
            }
        },
    });

    var form = $('#step7');
    $body.on("change", "#d_have_vaccinated", function () {
        form.valid();
        if ($(this).val() !== "No") {
            $('#i_have_vaccinated').rules("add", {
                required: true
            });
            form.valid();
        } else {
            $('#i_have_vaccinated').rules("remove");
            form.valid();
        }
    });

    $body.on("keyup", "[id^='i_medical_prob_'], [id^='i_type_surgery_'],  [id^='i_p_medication_'],   [id^='i_c_medication_'], [id^='i_substance_']"
        , function () {

            if ($(this).val() !== "") {

                var tr = $(this).closest('tr');

                var inputs = tr.find('input.form-control');

                inputs.each(function () {
                    if ($(this).val() === '') {
                        $(this).addClass('required');
                        $(this).valid();
                    } else {
                        $(this).removeClass('required');
                        $(this).closest('tr').find('label.error').remove();
                    }
                });
            } else {

                $(this).closest('tr').find('.form-control').val('');
                $(this).closest('tr').find('.form-control').removeClass('required');
                $(this).closest('tr').find('label.error').remove();
            }
        });


    $('body').on('click', '#submit7', function (evt) {
        evt.preventDefault();

        var form = $('#step7');

        var isValid = form.valid();

        if (!isValid) {
            scrollToError(form);
            return 0;
        } else {
            form.submit();
        }
    });

//endregion

//region (STEP 7) Medical History Step 2 Information saving using Ajax Logic
    $('#step7').submit(function (evt) {
        evt.preventDefault();

        var form = $(this);
        var btn = $(this).find('button.donor-submit');

        //if validation fails stop form submission
        var isValid = $(this).valid();
        if (!isValid) {
            scrollToError(form);
            return 0;
        }

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: form.attr('method'),
            data: form.serialize(),
            dataType: "json",
            success: function (response) {
                if (!response.error) {
                    $('#donor_q_next').click();
                    notify(response.message, response.title);
                } else {
                    notify(response.message, response.title);
                }
            },
            error: function (response) {

            },
            complete: function () {
                hideSpinner(btn);
            }
        });
    });
//endregion

//region (STEP 8) Medical History Step 3 Information Validation
    $('#step8').validate({
        rules: {
            cleft_lip: {
                required: true
            },
            cleft_lip_family: {
                required: true
            },
            cleft_palate: {
                required: true
            },
            cleft_palate_family: {
                required: true
            },
            hip_dislocation: {
                required: true
            },
            hip_dislocation_family: {
                required: true
            },
            clubfoot: {
                required: true
            },
            clubfoot_family: {
                required: true
            },
            heart_defect: {
                required: true
            },
            heart_defect_family: {
                required: true
            },
            hearing_issue: {
                required: true
            },
            hearing_issue_family: {
                required: true
            },
            spina_bifida: {
                required: true
            },
            spina_bifida_family: {
                required: true
            },
            microcephaly: {
                required: true
            },
            microcephaly_family: {
                required: true
            },
            holoprosencephaly: {
                required: true
            },
            holoprosencephaly_family: {
                required: true
            },
            death_at_birth: {
                required: true
            },
            death_at_birth_family: {
                required: true
            },
            dwarfism: {
                required: true
            },
            dwarfism_family: {
                required: true
            },
            hypospadias: {
                required: true
            },
            hypospadias_family: {
                required: true
            },
            pheny: {
                required: true
            },
            pheny_family: {
                required: true
            },
            polycystic: {
                required: true
            },
            polycystic_family: {
                required: true
            },
            pyloric: {
                required: true
            },
            pyloric_family: {
                required: true
            },
            other_congenital: {
                required: true
            },
            other_congenital_family: {
                required: true
            },

            //chromosomal abnormalities
            downs: {
                required: true
            },
            downs_family: {
                required: true
            },
            fragile_x: {
                required: true
            },
            fragile_x_family: {
                required: true
            },
            turner: {
                required: true
            },
            turner_family: {
                required: true
            },
            klinefelter: {
                required: true
            },
            klinefelter_family: {
                required: true
            },
            other_abnormality: {
                required: true
            },
            other_abnormality_family: {
                required: true
            },


            //genetic abnormalities
            alpha_1: {
                required: true
            },
            alpha_1_family: {
                required: true
            },
            bloom: {
                required: true
            },
            bloom_family: {
                required: true
            },
            canavan: {
                required: true
            },
            canavan_family: {
                required: true
            },
            cystic_fibrosis: {
                required: true
            },
            cystic_fibrosis_family: {
                required: true
            },
            fabry: {
                required: true
            },
            fabry_family: {
                required: true
            },
            factor_v: {
                required: true
            },
            factor_v_family: {
                required: true
            },
            familial_dis: {
                required: true
            },
            familial_dis_family: {
                required: true
            },
            familial_med: {
                required: true
            },
            familial_med_family: {
                required: true
            },
            fanconi: {
                required: true
            },
            fanconi_family: {
                required: true
            },
            hemophilia: {
                required: true
            },
            hemophilia_family: {
                required: true
            },
            marfan: {
                required: true
            },
            marfan_family: {
                required: true
            },
            mucolipidosis4: {
                required: true
            },
            mucolipidosis4_family: {
                required: true
            },
            niemann_pick: {
                required: true
            },
            niemann_pick_family: {
                required: true
            },
            sickle_cell: {
                required: true
            },
            sickle_cell_family: {
                required: true
            },
            tay_sachs: {
                required: true
            },
            tay_sachs_family: {
                required: true
            },
            thallasemia: {
                required: true
            },
            thallasemia_family: {
                required: true
            },
            blindness: {
                required: true
            },
            blindness_family: {
                required: true
            },
            color_blind: {
                required: true
            },
            color_blind_family: {
                required: true
            },
            deafness: {
                required: true
            },
            deafness_family: {
                required: true
            },
            albinism: {
                required: true
            },
            albinism_family: {
                required: true
            },
            muscular_dystrophy: {
                required: true
            },
            muscular_dystrophy_family: {
                required: true
            },
            galactosemia: {
                required: true
            },
            galactosemia_family: {
                required: true
            },
            hurlers: {
                required: true
            },
            hurlers_family: {
                required: true
            },
            other_genetic: {
                required: true
            },
            other_genetic_family: {
                required: true
            },

            //cancer abnormalities
            breast: {
                required: true
            },
            breast_family: {
                required: true
            },
            colon: {
                required: true
            },
            colon_family: {
                required: true
            },
            hnpcc: {
                required: true
            },
            hnpcc_family: {
                required: true
            },
            ovarian: {
                required: true
            },
            ovarian_family: {
                required: true
            },
            other_cancer: {
                required: true
            },
            other_cancer_family: {
                required: true
            },

            //neurologic abnormalities
            alzhemers: {
                required: true
            },
            alzhemers_family: {
                required: true
            },
            autism: {
                required: true
            },
            autism_family: {
                required: true
            },

            cerebral_palsy: {
                required: true
            },
            cerebral_palsy_family: {
                required: true
            },
            creultzfeldt: {
                required: true
            },
            creultzfeldt_family: {
                required: true
            },
            depression: {
                required: true
            },
            depression_family: {
                required: true
            },
            gauchers: {
                required: true
            }, gauchers_family: {
                required: true
            },
            huntingtons: {
                required: true
            },
            huntingtons_family: {
                required: true
            },
            hydrocephalus: {
                required: true
            },
            hydrocephalus_family: {
                required: true
            },
            obsessive: {
                required: true
            }, obsessive_family: {
                required: true
            },
            mania: {
                required: true
            },
            mania_family: {
                required: true
            },
            retardation: {
                required: true
            },
            retardation_family: {
                required: true
            },

            neurofibromatosis: {
                required: true
            },
            neurofibromatosis_family: {
                required: true
            },
            schizophrenia: {
                required: true
            },
            schizophrenia_family: {
                required: true
            },
            tourette: {
                required: true
            },
            tourette_family: {
                required: true
            },
            tuberous: {
                required: true
            },
            tuberous_family: {
                required: true
            },
            wilsons: {
                required: true
            }, wilsons_family: {
                required: true
            },
            multiple_sclerosis: {
                required: true
            }, multiple_sclerosis_family: {
                required: true
            },
            parkinsons: {
                required: true
            }, parkinsons_family: {
                required: true
            },
            lougehrigs: {
                required: true
            }, lougehrigs_family: {
                required: true
            },
            other_neurologic: {
                required: true
            },
            other_neurologic_family: {
                required: true
            },
            diabetes: {
                required: true
            }, diabetes_family: {
                required: true
            },
            heart_disease: {
                required: true
            },
            heart_disease_family: {
                required: true
            },
            high_bp: {
                required: true
            },
            high_bp_family: {
                required: true
            },
            asthma: {
                required: true
            },
            asthma_family: {
                required: true
            },
            lupus: {
                required: true
            },
            lupus_family: {
                required: true
            },
            obesity: {
                required: true
            },
            obesity_family: {
                required: true
            },

            alcoholism: {
                required: true
            }, alcoholism_family: {
                required: true
            },

            infertility: {
                required: true
            }, infertility_family: {
                required: true
            },

            miscarriage: {
                required: true
            }, miscarriage_family: {
                required: true
            },
            endometriosis: {
                required: true
            },
            endometriosis_family: {
                required: true
            },

            polycystic_ovary: {
                required: true
            },
            polycystic_ovary_family: {
                required: true
            },
            uterine_fibroids: {
                required: true
            },
            uterine_fibroids_family: {
                required: true
            }
        },
    });

    $body.on("change", "[name=cleft_lip_family]", function () {
        if ($(this).is('#cleft-lip-family-yes')) {
            $('#i_cleftlip').rules("add", {
                required: true
            });
        } else {
            $('#i_cleftlip').rules("remove");
        }
    });
    $body.on("change", "[name=cleft_palate_family]", function () {
        if ($(this).is('#cleft-palate-family-yes')) {
            $('#i_cleftpalate').rules("add", {
                required: true
            });
        } else {
            $('#i_cleftpalate').rules("remove");
        }
    });

    $body.on("change", "[name=hip_dislocation_family]", function () {
        if ($(this).is('#hip-dislocation-family-yes')) {
            $('#i_congenitalhip').rules("add", {
                required: true
            });
        } else {
            $('#i_congenitalhip').rules("remove");
        }
    });
    $body.on("change", "[name=clubfoot_family]", function () {
        if ($(this).is('#clubfoot-family-yes')) {
            $('#i_clubfoot').rules("add", {
                required: true
            });
        } else {
            $('#i_clubfoot').rules("remove");
        }
    });
    $body.on("change", "[name=heart_defect_family]", function () {
        if ($(this).is('#heart-defect-family-yes')) {
            $('#i_heartdefect').rules("add", {
                required: true
            });
        } else {
            $('#i_heartdefect').rules("remove");
        }
    });
    $body.on("change", "[name=hearing_issue_family]", function () {
        if ($(this).is('#hearing-issue-family-yes')) {
            $('#i_hearingproblems').rules("add", {
                required: true
            });
        } else {
            $('#i_hearingproblems').rules("remove");
        }
    });
    $body.on("change", "[name=spina_bifida_family]", function () {
        if ($(this).is('#spina-bifida-family-yes')) {
            $('#i_spina').rules("add", {
                required: true
            });
        } else {
            $('#i_spina').rules("remove");
        }
    });
    $body.on("change", "[name=microcephaly_family]", function () {
        if ($(this).is('#microcephaly-family-yes')) {
            $('#i_microcephaly').rules("add", {
                required: true
            });
        } else {
            $('#i_microcephaly').rules("remove");
        }
    });
    $body.on("change", "[name=holoprosencephaly_family]", function () {
        if ($(this).is('#holoprosencephaly-family-yes')) {
            $('#i_holoprosencephaly').rules("add", {
                required: true
            });
        } else {
            $('#i_holoprosencephaly').rules("remove");
        }
    });
    $body.on("change", "[name=death_at_birth_family]", function () {
        if ($(this).is('#death-at-birth-family-yes')) {
            $('#i_babiesdiedatbirth').rules("add", {
                required: true
            });
        } else {
            $('#i_babiesdiedatbirth').rules("remove");
        }
    });
    $body.on("change", "[name=dwarfism_family]", function () {
        if ($(this).is('#dwarfism-family-yes')) {
            $('#i_dwarfism').rules("add", {
                required: true
            });
        } else {
            $('#i_dwarfism').rules("remove");
        }
    });
    $body.on("change", "[name=hypospadias_family]", function () {
        if ($(this).is('#hypospadias-family-yes')) {
            $('#i_hypospadias').rules("add", {
                required: true
            });
        } else {
            $('#i_hypospadias').rules("remove");
        }
    });
    $body.on("change", "[name=pheny_family]", function () {
        if ($(this).is('#pheny-family-yes')) {
            $('#i_phenylketonuria').rules("add", {
                required: true
            });
        } else {
            $('#i_phenylketonuria').rules("remove");
        }
    });
    $body.on("change", "[name=polycystic_family]", function () {
        if ($(this).is('#polycystic-family-yes')) {
            $('#i_polycystickidney').rules("add", {
                required: true
            });
        } else {
            $('#i_polycystickidney').rules("remove");
        }
    });
    $body.on("change", "[name=pyloric_family]", function () {
        if ($(this).is('#pyloric-family-yes')) {
            $('#i_pyloricstenosis').rules("add", {
                required: true
            });
        } else {
            $('#i_pyloricstenosis').rules("remove");
        }
    });
    $body.on("change", "[name=other_congenital_family]", function () {
        if ($(this).is('#other-congenital-family-yes')) {
            $('#i_othercogenital').rules("add", {
                required: true
            });
        } else {
            $('#i_othercogenital').rules("remove");
        }
    });
    $body.on("change", "[name=downs_family]", function () {
        if ($(this).is('#downs-family-yes')) {
            $('#i_downsyndrome').rules("add", {
                required: true
            });
        } else {
            $('#i_downsyndrome').rules("remove");
        }
    });
    $body.on("change", "[name=fragile_x_family]", function () {
        if ($(this).is('#fragile-x-family-yes')) {
            $('#i_fragilex').rules("add", {
                required: true
            });
        } else {
            $('#i_fragilex').rules("remove");
        }
    });
    $body.on("change", "[name=turner_family]", function () {
        if ($(this).is('#turner-family-yes')) {
            $('#i_turnursyndrom').rules("add", {
                required: true
            });
        } else {
            $('#i_turnursyndrom').rules("remove");
        }
    });
    $body.on("change", "[name=klinefelter_family]", function () {
        if ($(this).is('#klinefelter-family-yes')) {
            $('#i_klinefelter').rules("add", {
                required: true
            });
        } else {
            $('#i_klinefelter').rules("remove");
        }
    });
    $body.on("change", "[name=other_abnormality_family]", function () {
        if ($(this).is('#other-abnormality-family-yes')) {
            $('#i_otherchromosomal').rules("add", {
                required: true
            });
        } else {
            $('#i_otherchromosomal').rules("remove");
        }
    });
    $body.on("change", "[name=alpha_1_family]", function () {
        if ($(this).is('#alpha-1-family-yes')) {
            $('#i_alpha_1_comment').rules("add", {
                required: true
            });
        } else {
            $('#i_alpha_1_comment').rules("remove");
        }
    });
    $body.on("change", "[name=bloom_family]", function () {
        if ($(this).is('#bloom-family-yes')) {
            $('#i_bloom').rules("add", {
                required: true
            });
        } else {
            $('#i_bloom').rules("remove");
        }
    });
    $body.on("change", "[name=canavan_family]", function () {
        if ($(this).is('#canavan-family-yes')) {
            $('#i_canavan').rules("add", {
                required: true
            });
        } else {
            $('#i_canavan').rules("remove");
        }
    });
    $body.on("change", "[name=cystic_fibrosis_family]", function () {
        if ($(this).is('#cystic-fibrosis-family-yes')) {
            $('#i_cysticfibroses').rules("add", {
                required: true
            });
        } else {
            $('#i_cysticfibroses').rules("remove");
        }
    });
    $body.on("change", "[name=fabry_family]", function () {
        if ($(this).is('#fabry-family-yes')) {
            $('#i_fabrydisease').rules("add", {
                required: true
            });
        } else {
            $('#i_fabrydisease').rules("remove");
        }
    });
    $body.on("change", "[name=factor_v_family]", function () {
        if ($(this).is('#factor-v-family-yes')) {
            $('#i_factorv').rules("add", {
                required: true
            });
        } else {
            $('#i_factorv').rules("remove");
        }
    });
    $body.on("change", "[name=familial_dis_family]", function () {
        if ($(this).is('#familial-dis-family-yes')) {
            $('#i_familial').rules("add", {
                required: true
            });
        } else {
            $('#i_familial').rules("remove");
        }
    });
    $body.on("change", "[name=familial_med_family]", function () {
        if ($(this).is('#familial-med-family-yes')) {
            $('#i_familialfever').rules("add", {
                required: true
            });
        } else {
            $('#i_familialfever').rules("remove");
        }
    });
    $body.on("change", "[name=fanconi_family]", function () {
        if ($(this).is('#fanconi-family-yes')) {
            $('#i_fanconi').rules("add", {
                required: true
            });
        } else {
            $('#i_fanconi').rules("remove");
        }
    });
    $body.on("change", "[name=hemophilia_family]", function () {
        if ($(this).is('#hemophilia-family-yes')) {
            $('#i_hemophilia').rules("add", {
                required: true
            });
        } else {
            $('#i_hemophilia').rules("remove");
        }
    });

    $body.on("change", "[name=marfan_family]", function () {
        if ($(this).is('#marfan-family-yes')) {
            $('#i_marfan').rules("add", {
                required: true
            });
        } else {
            $('#i_marfan').rules("remove");
        }
    });
    $body.on("change", "[name=mucolipidosis4_family]", function () {
        if ($(this).is('#mucolipidosis4-family-yes')) {
            $('#i_mucolipidosis').rules("add", {
                required: true
            });
        } else {
            $('#i_mucolipidosis').rules("remove");
        }
    });
    $body.on("change", "[name=niemann_pick_family]", function () {
        if ($(this).is('#niemann-pick-family-yes')) {
            $('#i_niemann').rules("add", {
                required: true
            });
        } else {
            $('#i_niemann').rules("remove");
        }
    });
    $body.on("change", "[name=sickle_cell_family]", function () {
        if ($(this).is('#sickle-cell-family-yes')) {
            $('#i_sickle').rules("add", {
                required: true
            });
        } else {
            $('#i_sickle').rules("remove");
        }
    });
    $body.on("change", "[name=tay_sachs_family]", function () {
        if ($(this).is('#tay-sachs-family-yes')) {
            $('#i_taysachs').rules("add", {
                required: true
            });
        } else {
            $('#i_taysachs').rules("remove");
        }
    });
    $body.on("change", "[name=thallasemia_family]", function () {
        if ($(this).is('#thallasemia-family-yes')) {
            $('#i_thallasmia').rules("add", {
                required: true
            });
        } else {
            $('#i_thallasmia').rules("remove");
        }
    });
    $body.on("change", "[name=blindness_family]", function () {
        if ($(this).is('#blindness-family-yes')) {
            $('#i_blindness').rules("add", {
                required: true
            });
        } else {
            $('#i_blindness').rules("remove");
        }
    });
    $body.on("change", "[name=color_blind_family]", function () {
        if ($(this).is('#color-blind-family-yes')) {
            $('#i_colorblind').rules("add", {
                required: true
            });
        } else {
            $('#i_colorblind').rules("remove");
        }
    });
    $body.on("change", "[name=deafness_family]", function () {
        if ($(this).is('#deafness-family-yes')) {
            $('#i_deafness').rules("add", {
                required: true
            });
        } else {
            $('#i_deafness').rules("remove");
        }
    });
    $body.on("change", "[name=albinism_family]", function () {
        if ($(this).is('#albinism-family-yes')) {
            $('#i_albinism').rules("add", {
                required: true
            });
        } else {
            $('#i_albinism').rules("remove");
        }
    });
    $body.on("change", "[name=muscular_dystrophy_family]", function () {
        if ($(this).is('#muscular-dystrophy-family-yes')) {
            $('#i_muscular').rules("add", {
                required: true
            });
        } else {
            $('#i_muscular').rules("remove");
        }
    });
    $body.on("change", "[name=galactosemia_family]", function () {
        if ($(this).is('#galactosemia-family-yes')) {
            $('#i_galactosemia').rules("add", {
                required: true
            });
        } else {
            $('#i_galactosemia').rules("remove");
        }
    });
    $body.on("change", "[name=hurlers_family]", function () {
        if ($(this).is('#hurlers-family-yes')) {
            $('#i_hurler').rules("add", {
                required: true
            });
        } else {
            $('#i_hurler').rules("remove");
        }
    });
    $body.on("change", "[name=other_genetic_family]", function () {
        if ($(this).is('#other-genetic-family-yes')) {
            $('#i_other_genetic').rules("add", {
                required: true
            });
        } else {
            $('#i_other_genetic').rules("remove");
        }
    });
    $body.on("change", "[name=breast_family]", function () {
        if ($(this).is('#breast-family-yes')) {
            $('#i_breast_cancer').rules("add", {
                required: true
            });
        } else {
            $('#i_breast_cancer').rules("remove");
        }
    });
    $body.on("change", "[name=colon_family]", function () {
        if ($(this).is('#colon-family-yes')) {
            $('#i_colon_cancer').rules("add", {
                required: true
            });
        } else {
            $('#i_colon_cancer').rules("remove");
        }
    });
    $body.on("change", "[name=hnpcc_family]", function () {
        if ($(this).is('#hnpcc-family-yes')) {
            $('#i_hereditary_non').rules("add", {
                required: true
            });
        } else {
            $('#i_hereditary_non').rules("remove");
        }
    });
    $body.on("change", "[name=ovarian_family]", function () {
        if ($(this).is('#ovarian-family-yes')) {
            $('#i_ovarian_cancer').rules("add", {
                required: true
            });
        } else {
            $('#i_ovarian_cancer').rules("remove");
        }
    });
    $body.on("change", "[name=other_cancer_family]", function () {
        if ($(this).is('#other-cancer-family-yes')) {
            $('#i_any_other_cancer').rules("add", {
                required: true
            });
        } else {
            $('#i_any_other_cancer').rules("remove");
        }
    });
    $body.on("change", "[name=alzhemers_family]", function () {
        if ($(this).is('#alzhemers-family-yes')) {
            $('#i_alzheimer').rules("add", {
                required: true
            });
        } else {
            $('#i_alzheimer').rules("remove");
        }
    });
    $body.on("change", "[name=autism_family]", function () {
        if ($(this).is('#autism-family-yes')) {
            $('#i_autism').rules("add", {
                required: true
            });
        } else {
            $('#i_autism').rules("remove");
        }
    });
    $body.on("change", "[name=cerebral_palsy_family]", function () {
        if ($(this).is('#cerebral-palsy-family-yes')) {
            $('#i_cerebral').rules("add", {
                required: true
            });
        } else {
            $('#i_cerebral').rules("remove");
        }
    });
    $body.on("change", "[name=creultzfeldt_family]", function () {
        if ($(this).is('#creultzfeldt-family-yes')) {
            $('#i_creultzfeldt').rules("add", {
                required: true
            });
        } else {
            $('#i_creultzfeldt').rules("remove");
        }
    });
    $body.on("change", "[name=depression_family]", function () {
        if ($(this).is('#depression-family-yes')) {
            $('#i_depression').rules("add", {
                required: true
            });
        } else {
            $('#i_depression').rules("remove");
        }
    });
    $body.on("change", "[name=gauchers_family]", function () {
        if ($(this).is('#gauchers-family-yes')) {
            $('#i_gaucher').rules("add", {
                required: true
            });
        } else {
            $('#i_gaucher').rules("remove");
        }
    });
    $body.on("change", "[name=huntingtons_family]", function () {
        if ($(this).is('#huntingtons-family-yes')) {
            $('#i_huntington').rules("add", {
                required: true
            });
        } else {
            $('#i_huntington').rules("remove");
        }
    });
    $body.on("change", "[name=hydrocephalus_family]", function () {
        if ($(this).is('#hydrocephalus-family-yes')) {
            $('#i_hydrocephalus').rules("add", {
                required: true
            });
        } else {
            $('#i_hydrocephalus').rules("remove");
        }
    });
    $body.on("change", "[name=obsessive_family]", function () {
        if ($(this).is('#obsessive-family-yes')) {
            $('#i_obsessive_compulsive').rules("add", {
                required: true
            });
        } else {
            $('#i_obsessive_compulsive').rules("remove");
        }
    });
    $body.on("change", "[name=mania_family]", function () {
        if ($(this).is('#mania-family-yes')) {
            $('#i_mania').rules("add", {
                required: true
            });
        } else {
            $('#i_mania').rules("remove");
        }
    });

    $body.on("change", "[name=retardation_family]", function () {
        if ($(this).is('#retardation-family-yes')) {
            $('#i_mental').rules("add", {
                required: true
            });
        } else {
            $('#i_mental').rules("remove");
        }
    });


    $body.on("change", "[name=neurofibromatosis_family]", function () {
        if ($(this).is('#neurofibromatosis-family-yes')) {
            $('#i_neurofibro').rules("add", {
                required: true
            });
        } else {
            $('#i_neurofibro').rules("remove");
        }
    });
    $body.on("change", "[name=schizophrenia_family]", function () {
        if ($(this).is('#schizophrenia-family-yes')) {
            $('#i_schizo').rules("add", {
                required: true
            });
        } else {
            $('#i_schizo').rules("remove");
        }
    });
    $body.on("change", "[name=tourette_family]", function () {
        if ($(this).is('#tourette-family-yes')) {
            $('#i_tourette').rules("add", {
                required: true
            });
        } else {
            $('#i_tourette').rules("remove");
        }
    });
    $body.on("change", "[name=tuberous_family]", function () {
        if ($(this).is('#tuberous-family-yes')) {
            $('#i_tuberous').rules("add", {
                required: true
            });
        } else {
            $('#i_tuberous').rules("remove");
        }
    });
    $body.on("change", "[name=wilsons_family]", function () {
        if ($(this).is('#wilsons-family-yes')) {
            $('#i_wilson_disease').rules("add", {
                required: true
            });
        } else {
            $('#i_wilson_disease').rules("remove");
        }
    });
    $body.on("change", "[name=multiple_sclerosis_family]", function () {
        if ($(this).is('#multiple-sclerosis-family-yes')) {
            $('#i_multiple_sclerosis').rules("add", {
                required: true
            });
        } else {
            $('#i_multiple_sclerosis').rules("remove");
        }
    });
    $body.on("change", "[name=parkinsons_family]", function () {
        if ($(this).is('#parkinsons-family-yes')) {
            $('#i_parkinson').rules("add", {
                required: true
            });
        } else {
            $('#i_parkinson').rules("remove");
        }
    });
    $body.on("change", "[name=lougehrigs_family]", function () {
        if ($(this).is('#lougehrigs-family-yes')) {
            $('#i_lou_gehrig').rules("add", {
                required: true
            });
        } else {
            $('#i_lou_gehrig').rules("remove");
        }
    });
    $body.on("change", "[name=other_neurologic_family]", function () {
        if ($(this).is('#other-neurologic-family-yes')) {
            $('#i_any_other_neuro').rules("add", {
                required: true
            });
        } else {
            $('#i_any_other_neuro').rules("remove");
        }
    });
    $body.on("change", "[name=diabetes_family]", function () {
        if ($(this).is('#diabetes-family-yes')) {
            $('#i_diabetes').rules("add", {
                required: true
            });
        } else {
            $('#i_diabetes').rules("remove");
        }
    });
    $body.on("change", "[name=heart_disease_family]", function () {
        if ($(this).is('#heart-disease-family-yes')) {
            $('#i_heart_disease').rules("add", {
                required: true
            });
        } else {
            $('#i_heart_disease').rules("remove");
        }
    });
    $body.on("change", "[name=high_bp_family]", function () {
        if ($(this).is('#high-bp-family-yes')) {
            $('#i_high_blood').rules("add", {
                required: true
            });
        } else {
            $('#i_high_blood').rules("remove");
        }
    });
    $body.on("change", "[name=asthma_family]", function () {
        if ($(this).is('#asthma-family-yes')) {
            $('#i_asthma').rules("add", {
                required: true
            });
        } else {
            $('#i_asthma').rules("remove");
        }
    });
    $body.on("change", "[name=lupus_family]", function () {
        if ($(this).is('#lupus-family-yes')) {

            $('#i_lupus').rules("add", {
                required: true
            });
        } else {
            $('#i_lupus').rules("remove");
        }
    });
    $body.on("change", "[name=obesity_family]", function () {
        if ($(this).is('#obesity-family-yes')) {

            $('#i_obesity').rules("add", {
                required: true
            });
        } else {
            $('#i_obesity').rules("remove");
        }
    });
    $body.on("change", "[name=alcoholism_family]", function () {
        if ($(this).is('#alcoholism-family-yes')) {

            $('#i_alcoholism').rules("add", {
                required: true
            });
        } else {
            $('#i_alcoholism').rules("remove");
        }
    });
    $body.on("change", "[name=infertility_family]", function () {
        if ($(this).is('#infertility-family-yes')) {

            $('#i_infertility').rules("add", {
                required: true
            });
        } else {
            $('#i_infertility').rules("remove");
        }
    });
    $body.on("change", "[name=miscarriage_family]", function () {
        if ($(this).is('#miscarriage-family-yes')) {

            $('#i_recurrent').rules("add", {
                required: true
            });
        } else {
            $('#i_recurrent').rules("remove");
        }
    });
    $body.on("change", "[name=endometriosis_family]", function () {
        if ($(this).is('#endometriosis-family-yes')) {

            $('#i_endometriosis').rules("add", {
                required: true
            });
        } else {
            $('#i_endometriosis').rules("remove");
        }
    });
    $body.on("change", "[name=polycystic_ovary_family]", function () {
        if ($(this).is('#polycystic-ovary-family-yes')) {

            $('#i_polycystic_ovary').rules("add", {
                required: true
            });
        } else {
            $('#i_polycystic_ovary').rules("remove");
        }
    });
    $body.on("change", "[name=uterine_fibroids_family]", function () {
        if ($(this).is('#uterine-fibroids-family-yes')) {

            $('#i_uterine_fibroids').rules("add", {
                required: true
            });
        } else {
            $('#i_uterine_fibroids').rules("remove");
        }
    });

    $('body').on('click', '#submit8', function (evt) {
        evt.preventDefault();

        var form = $('#step8');

        var isValid = form.valid();

        //adjusts the error label of comments fileds
        $("#step8 table tr td:last-child label.error").css({'top': '28px', 'left': '0px'});

        showRadioInputErrors(form);

        if (!isValid) {
            scrollToError(form);
            return 0;
        } else {
            form.submit();
        }
    });

//endregion

//region (STEP 8) Medical History Step 3 Information saving using Ajax Logic
    $('#step8').submit(function (evt) {
        evt.preventDefault();

        var form = $(this);
        var btn = $(this).find('button.donor-submit');

        //if validation fails stop form submission
        var isValid = $(this).valid();
        if (!isValid) {
            scrollToError(form);
            return 0;
        }

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: form.attr('method'),
            data: form.serialize(),
            dataType: "json",
            success: function (response) {
                if (!response.error) {
                    $('#donor_q_next').click();
                    notify(response.message, response.title);
                } else {
                    notify(response.message, response.title);
                }
            },
            error: function (response) {

            },
            complete: function () {
                hideSpinner(btn);
            }
        });
    });
//endregion

//region (STEP 9) Medical History Information Validation
    validator = $('#step9').validate({
        rules: {
            aids: {
                required: true
            },
            herpes: {
                required: true
            },
            gonorrhea: {
                required: true
            },
            chlamydia: {
                required: true
            },
            condyloma: {
                required: true
            },
            syphilis: {
                required: true
            },
            pid: {
                required: true
            },
            hepb: {
                required: true
            },
            hepc: {
                required: true
            },
            tuberculosis: {
                required: true
            },
            medication_allergies: {
                required: true
            },
            latex_allergies: {
                required: true
            },
            previous_surgery: {
                required: true
            },
            emotional_problems: {
                required: true
            },
            psychologist: {
                required: true
            },
            anti_depressants: {
                required: true
            }
        },
    });

    $body.on("change", "#d_aids", function () {
        if ($(this).val() !== "No") {
            $('#i_aids').rules("add", {
                required: true
            });
        } else {
            $('#i_aids').rules("remove");
        }
    });
    $body.on("change", "#d_herpes", function () {
        if ($(this).val() !== "No") {
            $('#i_herpes').rules("add", {
                required: true
            });
        } else {
            $('#i_herpes').rules("remove");
        }
    });
    $body.on("change", "#d_gonorrhea", function () {
        if ($(this).val() !== "No") {
            $('#i_gonorrhea').rules("add", {
                required: true
            });
        } else {
            $('#i_gonorrhea').rules("remove");
        }
    });
    $body.on("change", "#d_chlamydia", function () {
        if ($(this).val() !== "No") {
            $('#i_chlamydia').rules("add", {
                required: true
            });
        } else {
            $('#i_chlamydia').rules("remove");
        }
    });
    $body.on("change", "#d_condyloma", function () {
        if ($(this).val() !== "No") {
            $('#i_condyloma').rules("add", {
                required: true
            });
        } else {
            $('#i_condyloma').rules("remove");
        }
    });
    $body.on("change", "#d_syphilis", function () {
        if ($(this).val() !== "No") {
            $('#i_syphilis').rules("add", {
                required: true
            });
        } else {
            $('#i_syphilis').rules("remove");
        }
    });
    $body.on("change", "#d_pid", function () {
        if ($(this).val() !== "No") {
            $('#i_pid').rules("add", {
                required: true
            });
        } else {
            $('#i_pid').rules("remove");
        }
    });
    $body.on("change", "#d_hepatitisB", function () {
        if ($(this).val() !== "No") {
            $('#i_hepatitisB').rules("add", {
                required: true
            });
        } else {
            $('#i_hepatitisB').rules("remove");
        }
    });
    $body.on("change", "#d_hepatitisC", function () {
        if ($(this).val() !== "No") {
            $('#i_hepatitisC').rules("add", {
                required: true
            });
        } else {
            $('#i_hepatitisC').rules("remove");
        }
    });
    $body.on("change", "#d_tuberculosis", function () {
        if ($(this).val() !== "No") {
            $('#i_tuberculosis').rules("add", {
                required: true
            });
        } else {
            $('#i_tuberculosis').rules("remove");
        }
    });
    $body.on("change", "#d_allergies", function () {
        if ($(this).val() !== "No") {
            $('#i_allergies').rules("add", {
                required: true
            });
        } else {
            $('#i_allergies').rules("remove");
        }
    });
    $body.on("change", "#d_allergiesLatex", function () {
        if ($(this).val() !== "No") {
            $('#i_allergiesLatex').rules("add", {
                required: true
            });
        } else {
            $('#i_allergiesLatex').rules("remove");
        }
    });
    $body.on("change", "#d_previousSurgery", function () {
        if ($(this).val() !== "No") {
            $('#i_previousSurgery').rules("add", {
                required: true
            });
        } else {
            $('#i_previousSurgery').rules("remove");
        }
    });

    $body.on("change", "#d_emotional, #d_psychologist, #d_antiAnxiety", function () {
        if ($(this).val() !== "No") {
            $('#if_y_p_e').rules("add", {
                required: true
            });
        } else {
            $('#if_y_p_e').rules("remove");
        }
    });

    $body.on('click', '#submit9', function (evt) {
        evt.preventDefault();


        var form = $('#step9');

        var isValid = form.valid();

        if (!isValid) {
            scrollToError(form);
            return 0;
        } else {
            form.submit();
        }
    });

//endregion

//region (STEP 9) Medical History Step 4 Information saving using Ajax Logic
    $('#step9').submit(function (evt) {
        evt.preventDefault();

        var form = $(this);
        var btn = $(this).find('button.donor-submit');

        //if validation fails stop form submission
        var isValid = $(this).valid();
        if (!isValid) {
            scrollToError(form);
            return 0;
        }

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: form.attr('method'),
            data: form.serialize(),
            dataType: "json",
            success: function (response) {
                if (!response.error) {
                    $('#donor_q_next').click();
                    notify(response.message, response.title);
                } else {
                    notify(response.message, response.title);
                }
            },
            error: function (response) {

            },
            complete: function () {
                hideSpinner(btn);
            }
        });
    });
//endregion

//region (STEP 10) Donor Profile Information Validation
    $('#step10').validate({
        rules: {
            height: {
                required: true
            },
            weight: {
                required: true
            },
            race: {
                required: true
            },
            age: {
                required: true
            },
            mother: {
                required: true
            },
            mothers_mother: {
                required: true
            },
            mothers_father: {
                required: true
            },
            father: {
                required: true
            },
            fathers_mother: {
                required: true
            },
            fathers_father: {
                required: true
            },
            religion: {
                required: true
            },
            adopted: {
                required: true
            },
            weight_change: {
                required: true
            },
            dexterity: {
                required: true
            },
            bones: {
                required: true
            },
            complexion: {
                required: true
            },
            tan: {
                required: true
            },
            skin: {
                required: true
            },
            dimples: {
                required: true
            },
            eye_color: {
                required: true
            },
            eye_set: {
                required: true
            },
            eye_size: {
                required: true
            },
            eye_shape: {
                required: true
            },
            hair_color: {
                required: true
            },
            hair_type: {
                required: true
            },
            hair_texture: {
                required: true
            },
            hair_fullness: {
                required: true
            },
            baldness: {
                required: true
            },
            baldness_family: {
                required: true
            },
            graying: {
                required: true
            },
            body_facial_features: {
                required: true
            },
            teeth: {
                required: true
            },
            orthodontic_work: {
                required: true
            },
            hearing: {
                required: true
            },
            vision: {
                required: true
            },
            glasses: {
                required: true
            },
            stigmatism: {
                required: true
            },
            stigmatism_age: {
                required: true
            },
            /*            photo_permission: {
                            required: true
                        },*/
        }
    });

    var form = $('#step10');
    $body.on("change", "#d_weight_gain_loss", function () {
        form.valid();
        if ($(this).val() !== "No") {
            $('#i_weight_gain_loss').rules("add", {
                required: true
            });

            form.valid();

        } else {
            $('#i_weight_gain_loss').rules("remove");
            form.valid();
        }
    });
    $body.on("change", "#d_prematureGraying", function () {

        form.valid();
        if ($(this).val() !== "No") {
            $('#i_prematureGraying').rules("add", {
                required: true
            });

            form.valid();
        } else {
            $('#i_prematureGraying').rules("remove");
            form.valid();
        }
    });
    $body.on("change", "#d_periodonalword", function () {
        form.valid();
        if ($(this).val() !== "No") {
            $('#i_periodonalword').rules("add", {
                required: true
            });
            form.valid();
        } else {
            $('#i_periodonalword').rules("remove");
            form.valid();
        }
    });
    $body.on("change", "#d_glassesCorrective", function () {
        form.valid();
        if ($(this).val() !== "No") {
            $('#i_glassesCorrective').rules("add", {
                required: true
            });
            form.valid();
        } else {
            $('#i_glassesCorrective').rules("remove");
            form.valid();
        }
    });
    $body.on("change", "#d_stigmatism", function () {
        form.valid();
        if ($(this).val() !== "No") {
            $('#i_stigmatism').rules("add", {
                required: true
            });
            form.valid();
        } else {
            $('#i_stigmatism').rules("remove");
            form.valid();
        }
    });

    //at least one donation reason checkbox should be checked on checkbox click
    $body.on('click', '.egg-donation-reason', function () {
        validateDonationReason();
    });

    //on images choose change validate all the images
    $('#step10 .file-chooser').change(function () {
        var form = $('#step10');
        validateImages(form);
    });

    $body.on('click', '#submit10', function (evt) {
        evt.preventDefault();

        var form = $('#step10');


        var isValid = form.valid();

        var response = validateDonationReason();

        //if images has an errors stop form submission
        if (!validateImages(form)) return 0;

        if (isValid && response === 1) {
            form.submit();
        } else {
            return 0;
        }
    });
//endregion

//region (STEP 10) Donor Profile Information saving using Ajax Logic
    $('#step10').submit(function (evt) {
        evt.preventDefault();

        var form = $(this);
        var btn = $(this).find('button.donor-submit');

        var formData = new FormData(form[0]);

        //if validation fails stop form submission
        var isValid = $(this).valid();
        if (!isValid) {
            scrollToError(form);
            return 0;
        }

        showSpiner(btn);

        $.ajax({
            url: form.attr('action'),
            type: form.attr('method'),
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
                if (!response.error) {
                    notify(response.message, response.title);

                    remove_warning();
                    $('#successfully').modal({
                        backdrop: 'static',
                        keyboard: false
                    });

                } else {
                    notify(response.message, response.title);
                }
            },
            error: function (response) {

            },
            complete: function () {
                hideSpinner(btn);

            }
        });
    });
//endregion
});
$('#successfully').on('hidden.bs.modal', function () {
    window.location.replace('/');
});

/**
 * @description If college is checked then check the graduate high school automatically,
 * validate them, and disable them
 * @return {boolean}
 */
function validateSchool() {
    if ($('#high-school input[type=checkbox]:checked').length > 0) {
        $('#high-school .custom-error').remove();
        return true;
    } else {
        $('#high-school').append('<label class="error custom-error" style="display: block;">Please choose at least one option.</label>');
        return false;
    }
}

/**
 * @desc At least one donation reason
 * checkbox should be checked
 */
function validateDonationReason() {
    var response = 0;
    if ($('.egg-donation-reason').is(':checked')) {
        $('#egg-donation-reason .custom-error').remove();
        response = 1;
    } else {
        $('#egg-donation-reason').append('<label class="error custom-error" style="display: block;">Please choose at least one option.</label>');
        response = 0;
    }
    return response;
}


/**
 * @desc At least one current sexual practice
 * checkbox should be checked
 */
function validateCSexualPractice() {
    var response = 0;
    if ($('.cb-current-sexual').is(':checked')) {
        $('#current .custom-error').remove();
        response = 1;
    } else {
        $('#current').append('<label class="error custom-error" style="display: block !important;">Please choose at least one option.</label>');
        response = 0;
    }

    return response;
}

/**
 * @desc At least one  previous sexual practice
 * checkbox should be checked
 */
function validatePSexualPractice() {
    var response = false;
    if ($('.cb-previous-sexual').is(':checked')) {
        $('#previous .custom-error').remove();
        response = 1;
    } else {
        $('#previous').append('<label class="error custom-error" style="display: block;">Please choose at least one option.</label>');
        response = 0;
    }
    return response;
}

/**
 * @desc If any of the college checkbox is checked then check and disable school checkbox
 *
 */
function validateCollege() {
    if ($('.college').is(':checked')) {
        $('.high-school').prop('checked', false).prop('disabled', true);
        $('.high-school:last').prop('checked', true);

        //hide the high school error when college is checked
        $('#high-school .custom-error').remove();
    } else {
        $('.high-school').attr('disabled', false);
    }
}

/**
 * @desc Scroll top to error if there is any error
 * @return {number}
 */
function scrollToError(form) {

    //clear all the hidden errors label to make the scroll work properly
    form.find("label[style$='display: none;']").remove();

    //if error exists on page then
    if (form.find('.error, .c-error,.custom-error').length) {

        $('html, body').animate({
            scrollTop: (form.find('label.error,label.c-error, label.custom-error').offset().top - 300)
        }, 2000);
    }
}


function validateImages(form) {

    //empty files count
    var empty_files_count = 0;

    // clear all the custom image errors
    form.find('label.c-error').remove();

    form.find("input:file").each(function () {

        $(this).rules("add", {
            accept: "jpg|jpeg"
        });

        //check if input has an image
        var has_file = $(this).val().length;

        if (has_file === 0) {

            $(this).after('<label class="text-danger c-error" >Please choose an image</label>');
            empty_files_count++;
            return 0;
        }

    });

    //scroll to errors
    scrollToError(form);

    //if any of the file is missing then stop form submission
    return (empty_files_count < 1);
}

function showRadioInputErrors(form) {

    var radios = form.find('[type=radio]');

    radios.each(function () {
        if ($(this).hasClass('error')) {
            $(this).parents('.radio-boxes-container').addClass('error');
        }
    });

}

function getAge(dateString) {
    var today = new Date();
    var birthDate = new Date(dateString);
    var age = today.getFullYear() - birthDate.getFullYear();
    var m = today.getMonth() - birthDate.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }
    return age;
}

function attachCustomError() {

}



